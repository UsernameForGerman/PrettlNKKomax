{"ast":null,"code":"import _objectSpread from\"/home/whatruska/PycharmProjects/PrettlNKKomax/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import authApi from\"../DAL/auth/auth-api\";import group_api from\"../DAL/group_api/group_api\";import choose_komax_api from\"../DAL/choose_komax/choose_komax_api\";var checkLogged=function checkLogged(){var token=window.localStorage.getItem('token');return!(token===null);};var get=function get(prop){var value=window.localStorage.getItem(prop);if(value===null)return\"\";return value;};var initialState={isFetching:false,isLogged:checkLogged(),errMsg:\"\",token:get('token'),login:get('login'),role:get('role'),komax:get('komax')};var TOGGLE_FETCHING=\"LOGIN/TOGGLE_FETCHING\";var SET_LOGGED=\"LOGIN/SET_LOGGED\";var SET_TOKEN=\"LOGIN/SET_TOKEN\";var SET_ERROR=\"LOGIN/ERROR\";var SET_LOGIN=\"LOGIN/SET_LOGIN\";var SET_ROLE=\"LOGIN/SET_ROLE\";var SET_KOMAX=\"LOGIN/SET_KOMAX\";var LOGOUT=\"LOGIN/LOGOUT\";var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;var stateCopy=_objectSpread({},state);switch(action.type){case TOGGLE_FETCHING:{stateCopy.isFetching=!stateCopy.isFetching;break;}case SET_LOGGED:{stateCopy.isLogged=true;break;}case SET_TOKEN:{stateCopy.token=action.token;break;}case SET_ERROR:{stateCopy.errMsg=action.err;break;}case SET_LOGIN:{stateCopy.login=action.login;break;}case SET_ROLE:{stateCopy.role=action.role;break;}case LOGOUT:{stateCopy.token=null;stateCopy.isLogged=false;stateCopy.errMsg=\"\";stateCopy.login=\"\";stateCopy.role=\"\";stateCopy.komax=\"\";window.localStorage.clear();break;}case SET_KOMAX:{stateCopy.komax=action.komax;break;}}return stateCopy;};var toggleFetchAC=function toggleFetchAC(){return{type:TOGGLE_FETCHING};};var setLoginAC=function setLoginAC(login){return{type:SET_LOGIN,login:login};};var setRoleAC=function setRoleAC(role){return{type:SET_ROLE,role:role};};var setLoggedAC=function setLoggedAC(){return{type:SET_LOGGED};};var setTokenAC=function setTokenAC(token){return{type:SET_TOKEN,token:token};};var setErrAC=function setErrAC(err){return{type:SET_ERROR,err:err};};var logoutAC=function logoutAC(){return{type:LOGOUT};};var setKomaxAC=function setKomaxAC(komax){return{type:SET_KOMAX,komax:komax};};var authThunk=function authThunk(login,password){return function(dispatch){dispatch(toggleFetchAC());authApi.auth(login,password).then(function(token){window.localStorage.setItem('token',token);dispatch(setTokenAC(token));dispatch(setLoginAC(login));window.localStorage.setItem('login',login);dispatch(setLoggedAC());group_api.getGroup().then(function(data){if(data.length===0)return'Admin';return data[0].name;}).then(function(role){dispatch(setRoleAC(role));window.localStorage.setItem('role',role);dispatch(toggleFetchAC());});}).catch(function(err){dispatch(setErrAC(\"Invalid login or password\"));dispatch(toggleFetchAC());});};};var logoutThunk=function logoutThunk(){return function(dispatch){dispatch(toggleFetchAC());authApi.logout().then(function(resp){dispatch(logoutAC());dispatch(toggleFetchAC());});};};var chooseKomaxThunk=function chooseKomaxThunk(login,number){return function(dispatch){window.localStorage.setItem('komax',number);choose_komax_api.chooseKomax(login,number).then(function(resp){dispatch(setKomaxAC(number));});};};export{authReducer,authThunk,logoutThunk,chooseKomaxThunk,logoutAC};","map":{"version":3,"sources":["/home/whatruska/PycharmProjects/PrettlNKKomax/frontend/src/reducers/authReducer.js"],"names":["authApi","group_api","choose_komax_api","checkLogged","token","window","localStorage","getItem","get","prop","value","initialState","isFetching","isLogged","errMsg","login","role","komax","TOGGLE_FETCHING","SET_LOGGED","SET_TOKEN","SET_ERROR","SET_LOGIN","SET_ROLE","SET_KOMAX","LOGOUT","authReducer","state","action","stateCopy","type","err","clear","toggleFetchAC","setLoginAC","setRoleAC","setLoggedAC","setTokenAC","setErrAC","logoutAC","setKomaxAC","authThunk","password","dispatch","auth","then","setItem","getGroup","data","length","name","catch","logoutThunk","logout","resp","chooseKomaxThunk","number","chooseKomax"],"mappings":"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","sourcesContent":["import authApi from \"../DAL/auth/auth-api\";\nimport group_api from \"../DAL/group_api/group_api\";\nimport choose_komax_api from \"../DAL/choose_komax/choose_komax_api\";\n\nlet checkLogged = () => {\n    let token = window.localStorage.getItem('token');\n    return !(token === null);\n}\n\nlet get = (prop) => {\n    let value = window.localStorage.getItem(prop);\n    if (value === null) return \"\";\n    return value;\n}\n\nconst initialState = {\n    isFetching : false,\n    isLogged : checkLogged(),\n    errMsg : \"\",\n    token : get('token'),\n    login : get('login'),\n    role : get('role'),\n    komax : get('komax')\n}\n\nconst TOGGLE_FETCHING = \"LOGIN/TOGGLE_FETCHING\";\nconst SET_LOGGED = \"LOGIN/SET_LOGGED\";\nconst SET_TOKEN = \"LOGIN/SET_TOKEN\";\nconst SET_ERROR = \"LOGIN/ERROR\";\nconst SET_LOGIN = \"LOGIN/SET_LOGIN\";\nconst SET_ROLE = \"LOGIN/SET_ROLE\";\nconst SET_KOMAX = \"LOGIN/SET_KOMAX\";\nconst LOGOUT = \"LOGIN/LOGOUT\";\n\nconst authReducer = (state = initialState, action) => {\n    let stateCopy = {...state};\n    switch (action.type) {\n        case TOGGLE_FETCHING : {\n            stateCopy.isFetching = !stateCopy.isFetching;\n            break;\n        }\n\n        case SET_LOGGED : {\n            stateCopy.isLogged = true;\n            break;\n        }\n\n        case SET_TOKEN : {\n            stateCopy.token = action.token;\n            break;\n        }\n\n        case SET_ERROR : {\n            stateCopy.errMsg = action.err;\n            break;\n        }\n\n        case SET_LOGIN : {\n            stateCopy.login = action.login;\n            break;\n        }\n\n        case SET_ROLE : {\n            stateCopy.role = action.role;\n            break;\n        }\n\n        case LOGOUT : {\n            stateCopy.token = null;\n            stateCopy.isLogged = false;\n            stateCopy.errMsg = \"\";\n            stateCopy.login = \"\";\n            stateCopy.role = \"\";\n            stateCopy.komax = \"\";\n            window.localStorage.clear();\n            break;\n        }\n\n        case SET_KOMAX : {\n            stateCopy.komax = action.komax;\n            break;\n        }\n    }\n    return stateCopy;\n}\n\nconst toggleFetchAC = () => {\n    return {\n        type : TOGGLE_FETCHING\n    }\n}\n\nconst setLoginAC = (login) => {\n    return {\n        type : SET_LOGIN,\n        login : login\n    }\n}\n\nconst setRoleAC = (role) => {\n    return {\n        type : SET_ROLE,\n        role : role\n    }\n}\n\nconst setLoggedAC = () => {\n    return {\n        type : SET_LOGGED\n    }\n}\n\nconst setTokenAC = (token) => {\n    return {\n        type : SET_TOKEN,\n        token : token\n    }\n}\n\nconst setErrAC = (err) => {\n    return {\n        type : SET_ERROR,\n        err : err\n    }\n}\n\nconst logoutAC = () => {\n    return{\n        type : LOGOUT\n    }\n}\n\nconst setKomaxAC = (komax) => {\n    return {\n        type : SET_KOMAX,\n        komax : komax\n    }\n}\n\n\nconst authThunk = (login, password) => {\n    return (dispatch) => {\n        dispatch(toggleFetchAC());\n        authApi.auth(login, password).then((token) => {\n            window.localStorage.setItem('token', token);\n            dispatch(setTokenAC(token));\n            dispatch(setLoginAC(login));\n            window.localStorage.setItem('login', login);\n            dispatch(setLoggedAC());\n            group_api.getGroup().then(data => {\n                if (data.length === 0) return 'Admin';\n                return data[0].name\n            }).then(role => {\n                dispatch(setRoleAC(role));\n                window.localStorage.setItem('role', role);\n                dispatch(toggleFetchAC());\n            });\n        }).catch((err) => {\n            dispatch(setErrAC(\"Invalid login or password\"));\n            dispatch(toggleFetchAC());\n        });\n    }\n}\n\nconst logoutThunk = () => {\n    return (dispatch) => {\n        dispatch(toggleFetchAC());\n        authApi.logout().then(resp => {\n            dispatch(logoutAC());\n            dispatch(toggleFetchAC());\n        })\n    }\n}\n\nconst chooseKomaxThunk = (login, number) => {\n    return (dispatch) => {\n        window.localStorage.setItem('komax', number);\n        choose_komax_api.chooseKomax(login, number).then(resp => {\n            dispatch(setKomaxAC(number));\n        });\n    }\n}\n\nexport {authReducer, authThunk, logoutThunk, chooseKomaxThunk, logoutAC}"]},"metadata":{},"sourceType":"module"}